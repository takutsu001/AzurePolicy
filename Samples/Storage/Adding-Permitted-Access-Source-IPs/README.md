# ストレージアカウントにて許可するアクセス元IPを追加する

### 概要
このAzure Policyは、ストレージアカウントのパブリックネットワークアクセスが有効になっている場合に、特定のネットワークアクセス制御設定を強制的に適用するものです。ポリシーの効果は Modify または Disabled のいずれかを選択できますが、デフォルトでは Modify になっています

### 目的
このポリシーの目的は、パブリックネットワークアクセスが有効なストレージアカウントに対して、セキュリティを強化するためのネットワークアクセス制御を自動的に適用することです。これにより、すべてのネットワークからのアクセスをデフォルトで拒否し、特定のIPアドレスのみがアクセスを許可されるように制御されます

### ポリシーの適用条件
- リソースの種類: Microsoft.Storage/storageAccounts であること
- パブリックネットワークアクセス: Enabled（有効）であること

これらの条件を満たした場合、ポリシーが適用され、次の操作が実行されます
- デフォルトのネットワークACLアクションを Deny に設定
- 指定されたIPアドレス（1.1.1.1 および 2.2.2.2）のみを許可するルールを追加

また、このポリシーを適用するには特定のロール（roleDefinitionIds）が必要で、競合が発生した場合は監査（audit）が行われます

### 本ポリシーの動作についての補足
- ポリシーで指定した許可IPアドレスが追加される（1.1.1.1 と 2.2.2.2）
- パブリックネットワークアクセスが「すべてのネットワークから有効」もしくは「選択した仮想ネットワークとIPアドレスから有効」で作成された場合は、許可IPアドレスが追加される
- パブリックネットワークアクセスが「無効」で作成された場合は許可IPアドレスは追加されない

> [!NOTE]
> 本説明はChatGPTを利用して作成しています